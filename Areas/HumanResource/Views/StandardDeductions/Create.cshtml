@model Standus_5_0.Areas.HumanResource.Models.StandardDeduction

@{
    ViewData["Title"] = "Create";
    Layout = "~/Areas/HumanResource/Views/Shared/_Layout.cshtml";
}

<h5>Add Standard Deduction</h5>
<hr />
<div class="standard-row-container">
<div class="row" style="width:60%">
    <div class="col-md-8">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="EmployeeID" class="control-label"></label>
                <select asp-for="EmployeeID" class ="form-control" asp-items="ViewBag.EmployeeID"></select>
            </div>
            <div class="form-group">
                <label asp-for="Type" class="control-label"></label>
                <input asp-for="Type" class="form-control" />
                <span asp-validation-for="Type" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Employee" class="control-label"></label>
                <input asp-for="Employee" class="form-control" />
                <span asp-validation-for="Employee" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Employer" class="control-label"></label>
                <input asp-for="Employer" class="form-control" />
                <span asp-validation-for="Employer" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="DeductionID" class="control-label"></label>
                <select asp-for="DeductionID" class ="form-control" asp-items="ViewBag.DeductionID"></select>
            </div>
            <div class="form-group">
                <input type="button" value="Create" class="btn btn-primary" id="submit"/>
            </div>
       
    </div>
        <div>
            <a asp-action="Index">Back to List</a>
        </div>
</div>



    <div id="StandardDeductionCalculation" style="width:40%">

</div>

</div>
<script>
    $(document).ready(function() {
        $.ajax({
            url: '/humanresource/standarddeductioncalculations/index',
            type:'GET',
            data: {deductionid:0},
            success : function(result) {
                $('#StandardDeductionCalculation').html(result);
            },
            error : function (xhr , status , error){
                console.error("AJAX Error: " + error);
            }
        });
    });

    $("#submit").on('click',function() {
        var formData = {
            employeeid : $("#EmployeeID").val(),
            type: $("#Type").val(),
            employee: $("#Employee").val(),
            employer: $("#Employer").val(),
            deductionid: $("#DeductionID").val(),
            allowances:[]
        }

        $(".calculate_on").each(function() {
            var is_selected = $(this).find('input[name$=".deductionid"]').prop('checked');
            var allowanceid;
            if (is_selected) {

                allowanceid = $(this).find('input[name$=".allowanceid"]').val();
                formData.allowances.push(allowanceid);
            }
        });
        console.log(formData);

        $.ajax({
            url: '@Url.Action("Create", "StandardDeductions")',  // Replace with your controller's Create action URL
            type: 'POST',  // HTTP method
            data: JSON.stringify(formData),  // Convert to JSON string
            contentType: 'application/json',  // Tell the server we're sending JSON
            success: function (response) {
                // Handle success
                alert('Form submitted successfully!');
                console.log(response);  // Display or process the response here
            },
            error: function (xhr, status, error) {
                // Handle error
                alert('Error occurred while submitting the form!');
                console.log(error);
            }
        });
    });
</script>

